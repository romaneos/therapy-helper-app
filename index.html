<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="–¢–µ—Ä–∞–ø–∏—è">
    <meta name="theme-color" content="#f8fafc">
    <title>–£—á—ë—Ç —Å–µ—Å—Å–∏–π</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="data:application/json,{
        &quot;name&quot;: &quot;–£—á—ë—Ç —Ç–µ—Ä–∞–ø–∏–∏&quot;,
        &quot;short_name&quot;: &quot;–¢–µ—Ä–∞–ø–∏—è&quot;,
        &quot;start_url&quot;: &quot;.&quot;,
        &quot;display&quot;: &quot;standalone&quot;,
        &quot;background_color&quot;: &quot;%23f8fafc&quot;,
        &quot;theme_color&quot;: &quot;%23f8fafc&quot;
    }">
    
    <!-- Apple Touch Icon -->
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect fill='%2364b5c6' width='100' height='100' rx='20'/><text x='50' y='68' text-anchor='middle' font-size='50'>üß†</text></svg>">

    <!-- Materialize CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
    <!-- Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!-- App styles -->
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div class="app">
        <!-- Clients Screen -->
        <section id="clientsScreen" class="screen">
            <div class="screen-header">
                <div class="row valign-wrapper" style="margin: 24px 0 16px;">
                    <h5 class="col s9" style="margin: 0;"><i class="material-icons" style="font-size: 24px; vertical-align: middle; margin-right: 6px;">groups</i> –ö–ª–∏–µ–Ω—Ç—ã</h5>
                    <a href="#!" class="col s3 right-align teal-text text-darken-2" onclick="openClientModal(); return false;">+ –î–æ–±–∞–≤–∏—Ç—å</a>
                </div>
            </div>
            <div id="clientsList"></div>
        </section>
        
        <!-- Sessions Screen -->
        <section id="sessionsScreen" class="screen active">
            <div class="screen-header">
                <div class="row valign-wrapper" style="margin: 24px 0 16px;">
                    <h5 class="col s9" style="margin: 0;"><i class="material-icons" style="font-size: 24px; vertical-align: middle; margin-right: 6px;">event_available</i> –°–µ—Å—Å–∏–∏</h5>
                    <a href="#!" class="col s3 right-align teal-text text-darken-2" onclick="openSessionModal(); return false;">+ –î–æ–±–∞–≤–∏—Ç—å</a>
                </div>
            </div>
            <div id="sessionsList"></div>
        </section>
        
        <!-- Stats Screen -->
        <section id="statsScreen" class="screen">
            <div class="screen-header">
                <div class="row valign-wrapper" style="margin: 24px 0 16px;">
                    <h5 class="col s12" style="margin: 0;"><i class="material-icons" style="font-size: 24px; vertical-align: middle; margin-right: 6px;">insights</i> –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h5>
                </div>
            </div>
            <div class="input-field col s12" style="margin-bottom: 16px;">
                <select id="statsCurrency" onchange="renderStats()">
                    <option value="USD">USD ‚Äî –î–æ–ª–ª–∞—Ä –°–®–ê</option>
                    <option value="EUR">EUR ‚Äî –ï–≤—Ä–æ</option>
                    <option value="PLN">PLN ‚Äî –ü–æ–ª—å—Å–∫–∏–π –∑–ª–æ—Ç—ã–π</option>
                </select>
                <label>–û—Ç–æ–±—Ä–∞–∂–∞—Ç—å –≤ –≤–∞–ª—é—Ç–µ</label>
            </div>
            
            <div class="row" style="margin-bottom: 20px;">
                <button class="btn btn-small teal date-filter-btn" data-period="week">–ù–µ–¥–µ–ª—è</button>
                <button class="btn btn-small waves-effect grey lighten-2 grey-text text-darken-2 date-filter-btn" data-period="month">–ú–µ—Å—è—Ü</button>
                <button class="btn btn-small waves-effect grey lighten-2 grey-text text-darken-2 date-filter-btn" data-period="year">–ì–æ–¥</button>
                <button class="btn btn-small waves-effect grey lighten-2 grey-text text-darken-2 date-filter-btn" data-period="all">–í—Å—ë –≤—Ä–µ–º—è</button>
            </div>
            
            <div class="row">
                <div class="col s6">
                    <div class="card">
                        <div class="card-content">
                            <i class="material-icons teal-text" style="font-size: 28px; margin-bottom: 8px;">attach_money</i>
                            <span class="card-title" style="font-size: 24px;" id="totalIncome">0</span>
                            <p class="grey-text" style="font-size: 12px; margin-top: 4px;">–î–æ—Ö–æ–¥ –∑–∞ –ø–µ—Ä–∏–æ–¥</p>
                        </div>
                    </div>
                </div>
                <div class="col s6">
                    <div class="card">
                        <div class="card-content">
                            <i class="material-icons teal-text" style="font-size: 28px; margin-bottom: 8px;">format_list_numbered</i>
                            <span class="card-title" style="font-size: 24px;" id="totalSessions">0</span>
                            <p class="grey-text" style="font-size: 12px; margin-top: 4px;">–°–µ—Å—Å–∏–π –ø—Ä–æ–≤–µ–¥–µ–Ω–æ</p>
                        </div>
                    </div>
                </div>
                <div class="col s12">
                    <div class="card">
                        <div class="card-content">
                            <i class="material-icons orange-text text-darken-2" style="font-size: 28px; margin-bottom: 8px;">report_problem</i>
                            <span class="card-title" style="font-size: 24px;" id="totalDebt">0</span>
                            <p class="grey-text" style="font-size: 12px; margin-top: 4px;">–û–±—â–∏–π –¥–æ–ª–≥ –∫–ª–∏–µ–Ω—Ç–æ–≤</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="row" style="margin: 24px 0 16px;">
                <h5 class="col s12" style="margin: 0;"><i class="material-icons" style="font-size: 24px; vertical-align: middle; margin-right: 6px;">credit_card</i> –î–æ–ª–≥–∏ –ø–æ –∫–ª–∏–µ–Ω—Ç–∞–º</h5>
            </div>
            
            <div id="debtsList"></div>
            
            <p id="exchangeRateInfo" class="grey-text center-align card-panel grey lighten-4" style="font-size: 12px; margin-top: 20px; padding: 12px;"></p>
        </section>
        
        <!-- Settings Screen -->
        <section id="settingsScreen" class="screen">
            <div class="screen-header">
                <div class="row" style="margin: 24px 0 16px;">
                    <h5 class="col s12" style="margin: 0;"><i class="material-icons" style="font-size: 24px; vertical-align: middle; margin-right: 6px;">tune</i> –ù–∞—Å—Ç—Ä–æ–π–∫–∏</h5>
                </div>
            </div>
            <ul class="collection">
                <li class="collection-item avatar valign-wrapper">
                    <i class="material-icons circle teal lighten-4 teal-text">cloud</i>
                    <div class="col s8">
                        <span class="title">Google Sheets</span>
                        <p id="sheetsStatus" class="grey-text">–ù–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ</p>
                    </div>
                    <span class="secondary-content"><button class="btn waves-effect waves-light grey btn-small" onclick="openSettingsModal(); return false;">–ù–∞—Å—Ç—Ä–æ–∏—Ç—å</button></span>
                </li>
                <li class="collection-item avatar valign-wrapper" id="syncQueueItem" style="display: none;">
                    <i class="material-icons circle teal lighten-4 teal-text">sync</i>
                    <div class="col s8">
                        <span class="title">–û—á–µ—Ä–µ–¥—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏</span>
                        <p id="syncQueueStatus" class="grey-text">0 –æ–ø–µ—Ä–∞—Ü–∏–π –≤ –æ—á–µ—Ä–µ–¥–∏</p>
                    </div>
                    <span class="secondary-content"><button class="btn waves-effect waves-light grey btn-small" onclick="forceSyncNow(); return false;">–°–∏–Ω—Ö—Ä.</button></span>
                </li>
                <li class="collection-item avatar valign-wrapper">
                    <i class="material-icons circle teal lighten-4 teal-text">file_upload</i>
                    <div class="col s8">
                        <span class="title">–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</span>
                        <p class="grey-text">–°–∫–∞—á–∞—Ç—å JSON —Ñ–∞–π–ª</p>
                    </div>
                    <span class="secondary-content"><button class="btn waves-effect waves-light grey btn-small" onclick="exportData(); return false;">–°–∫–∞—á–∞—Ç—å</button></span>
                </li>
                <li class="collection-item avatar valign-wrapper">
                    <i class="material-icons circle teal lighten-4 teal-text">file_download</i>
                    <div class="col s8">
                        <span class="title">–ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</span>
                        <p class="grey-text">–ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑ JSON</p>
                    </div>
                    <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importData(event)">
                    <span class="secondary-content"><button class="btn waves-effect waves-light grey btn-small" onclick="document.getElementById('importFile').click(); return false;">–ó–∞–≥—Ä—É–∑–∏—Ç—å</button></span>
                </li>
                <li class="collection-item avatar valign-wrapper">
                    <i class="material-icons circle red lighten-4 red-text">delete</i>
                    <div class="col s8">
                        <span class="title">–û—á–∏—Å—Ç–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</span>
                        <p class="grey-text">–£–¥–∞–ª–∏—Ç—å –≤—Å–µ –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</p>
                    </div>
                    <span class="secondary-content"><button class="btn waves-effect waves-light red btn-small" onclick="clearAllData(); return false;">–û—á–∏—Å—Ç–∏—Ç—å</button></span>
                </li>
            </ul>
        </section>
        
        <!-- FAB Button (Materialize) -->
        <div class="fixed-action-btn" id="fabButton">
            <a class="btn-floating btn-large waves-effect waves-light teal" onclick="handleFabClick()">
                <i class="material-icons">add</i>
            </a>
        </div>
        
        <!-- Bottom Navigation (Materialize) -->
        <div class="navbar-fixed bottom-nav-wrapper">
            <nav>
                <div class="nav-wrapper">
                    <ul class="bottom-nav-tabs">
                        <li class="nav-tab-item">
                            <a href="#!" class="nav-tab-link" data-screen="clientsScreen">
                                <i class="material-icons">groups</i>
                            </a>
                        </li>
                        <li class="nav-tab-item">
                            <a href="#!" class="nav-tab-link active" data-screen="sessionsScreen">
                                <i class="material-icons">event_available</i>
                            </a>
                        </li>
                        <li class="nav-tab-item">
                            <a href="#!" class="nav-tab-link" data-screen="statsScreen">
                                <i class="material-icons">insights</i>
                            </a>
                        </li>
                        <li class="nav-tab-item">
                            <a href="#!" class="nav-tab-link" data-screen="settingsScreen">
                                <i class="material-icons">tune</i>
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>
        </div>
    </div>
    
    <!-- Client Modal (Materialize) -->
    <div id="clientModal" class="modal bottom-sheet">
        <div class="modal-content">
            <h4 id="clientModalTitle">–ù–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç</h4>
            <form id="clientForm">
                <input type="hidden" id="clientId">

                <div class="input-field">
                    <i class="material-icons prefix">person</i>
                    <input type="text" id="clientName" required>
                    <label for="clientName">–ò–º—è –∫–ª–∏–µ–Ω—Ç–∞</label>
                </div>

                <div class="input-field">
                    <i class="material-icons prefix">credit_card</i>
                    <input type="number" id="clientRate" required>
                    <label for="clientRate">–°—Ç–æ–∏–º–æ—Å—Ç—å —Å–µ—Å—Å–∏–∏</label>
                </div>

                <div class="input-field">
                    <i class="material-icons prefix">currency_exchange</i>
                    <select id="clientCurrency" required>
                        <option value="USD">USD ‚Äî –î–æ–ª–ª–∞—Ä –°–®–ê</option>
                        <option value="EUR">EUR ‚Äî –ï–≤—Ä–æ</option>
                        <option value="PLN">PLN ‚Äî –ü–æ–ª—å—Å–∫–∏–π –∑–ª–æ—Ç—ã–π</option>
                    </select>
                    <label>–í–∞–ª—é—Ç–∞</label>
                </div>

                <div class="input-field">
                    <i class="material-icons prefix">notes</i>
                    <textarea id="clientNotes" class="materialize-textarea"></textarea>
                    <label for="clientNotes">–ó–∞–º–µ—Ç–∫–∏</label>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <a href="#!" class="modal-close waves-effect waves-teal btn-flat">–û—Ç–º–µ–Ω–∞</a>
            <button type="submit" form="clientForm" class="waves-effect waves-light btn teal">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        </div>
    </div>
    
    <!-- Session Modal (Materialize) -->
    <div id="sessionModal" class="modal bottom-sheet">
        <div class="modal-content">
            <h4 id="sessionModalTitle">–ù–æ–≤–∞—è —Å–µ—Å—Å–∏—è</h4>
            <form id="sessionForm">
                <input type="hidden" id="sessionId">

                <div class="input-field">
                    <i class="material-icons prefix">person</i>
                    <select id="sessionClient" required>
                        <option value="" disabled selected>–í—ã–±–µ—Ä–∏—Ç–µ –∫–ª–∏–µ–Ω—Ç–∞</option>
                    </select>
                    <label>–ö–ª–∏–µ–Ω—Ç</label>
                </div>

                <div class="input-field">
                    <i class="material-icons prefix">event_available</i>
                    <input type="text" id="sessionDate" class="datepicker" required>
                    <label for="sessionDate">–î–∞—Ç–∞ —Å–µ—Å—Å–∏–∏</label>
                </div>

                <div class="input-field">
                    <i class="material-icons prefix">credit_card</i>
                    <input type="number" id="sessionAmount" required>
                    <label for="sessionAmount">–°—Ç–æ–∏–º–æ—Å—Ç—å</label>
                </div>
                <label>
                    <input type="checkbox" id="sessionPaid" class="filled-in" />
                    <span>–û–ø–ª–∞—á–µ–Ω–æ</span>
                </label>

                <div class="input-field">
                    <i class="material-icons prefix">notes</i>
                    <textarea id="sessionNotes" class="materialize-textarea"></textarea>
                    <label for="sessionNotes">–ó–∞–º–µ—Ç–∫–∏ –∫ —Å–µ—Å—Å–∏–∏</label>
                </div>

                <button type="button" id="sessionDeleteBtn" class="btn red waves-effect waves-light" style="display: none; margin-top: 16px; width: 100%;" onclick="deleteSession()">
                    <i class="material-icons left">delete</i>–£–¥–∞–ª–∏—Ç—å —Å–µ—Å—Å–∏—é
                </button>
            </form>
        </div>
        <div class="modal-footer">
            <a href="#!" class="modal-close waves-effect waves-teal btn-flat">–û—Ç–º–µ–Ω–∞</a>
            <button type="submit" form="sessionForm" class="waves-effect waves-light btn teal">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        </div>
    </div>

    <!-- Client Detail Modal (Materialize) -->
    <div id="clientDetailModal" class="modal bottom-sheet">
        <div class="modal-content" id="clientDetailContent"></div>
        <div class="modal-footer">
            <a href="#!" class="modal-close waves-effect waves-teal btn-flat">–ó–∞–∫—Ä—ã—Ç—å</a>
        </div>
    </div>

    <!-- Settings Modal -->
    <!-- Settings Modal (Materialize) -->
    <div id="settingsModal" class="modal bottom-sheet">
        <div class="modal-content">
            <h4>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ Google Sheets</h4>
            <form id="settingsForm">
                <div class="input-field">
                    <i class="material-icons prefix">link</i>
                    <input type="url" id="scriptUrl" placeholder="https://script.google.com/macros/s/...">
                    <label for="scriptUrl">URL Google Apps Script</label>
                </div>

                <div class="card-panel teal lighten-5">
                    <span class="teal-text text-darken-2">
                        <i class="material-icons tiny">info</i>
                        –î–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å–æ–∑–¥–∞–π—Ç–µ Google Apps Script –∏ –≤—Å—Ç–∞–≤—å—Ç–µ URL —Ä–∞–∑–≤—ë—Ä–Ω—É—Ç–æ–≥–æ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
                        –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Ñ–∞–π–ª–µ google-apps-script.js
                    </span>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <a href="#!" class="modal-close waves-effect waves-teal btn-flat">–û—Ç–º–µ–Ω–∞</a>
            <button type="submit" form="settingsForm" class="waves-effect waves-light btn teal">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        </div>
    </div>

    <!-- ES Module: Sync Services -->
    <script type="module" src="js/app.js"></script>

    <!-- Materialize JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    <!-- App (depends on Materialize) -->
    <script src="js/main.js"></script>
</body>
</html>
